# replace default config.bcm based on profile l2/l3
CONFIG_PROFILES_BASE=/usr/share/broadcom_sonic/config_profiles
if [ -d  ${CONFIG_PROFILES_BASE} ]; then
    ACTIVE_PROFILE_FLAG=${CONFIG_PROFILES_BASE}/active

    PLATFORM=`sonic-cfggen -H -v DEVICE_METADATA.localhost.platform`
    PRESET=(`head -n 1 /usr/share/sonic/device/$PLATFORM/default_sku`)
    HW_KEY=${PRESET[0]}

    CONFIG_FILE_DIR=/usr/share/sonic/device/$PLATFORM/$HW_KEY
    CONFIG_FILE_ACTIVE_PROFILE_DIR=/usr/share/sonic/device/$PLATFORM/$HW_KEY/$(cat ${ACTIVE_PROFILE_FLAG})
    if [ -d ${CONFIG_FILE_ACTIVE_PROFILE_DIR} ]; then
        sudo sed -i "/\b\(l2_mem_entries\|l3_mem_entries\|l3_alpm_enable\)\b/d" ${CONFIG_FILE_DIR}/*config.bcm 
        sudo sed -i "/\b\(use_all_splithorizon_groups\|flow_init_mode\|sai_tunnel_support\)\b/d" ${CONFIG_FILE_DIR}/*config.bcm 
        sudo cat ${CONFIG_FILE_ACTIVE_PROFILE_DIR}/config >> ${CONFIG_FILE_DIR}/*config.bcm
    fi
fi
